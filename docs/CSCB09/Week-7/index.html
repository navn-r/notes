<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Week 7 Programming in C (cont.) Compiler and Linker Stages myProgram.c $\to$ Compiler $\to$ Machine Code (myProgram.o) $\to$ Libraries + Linker $\to$ Executable
 myProgram.o is the object code file Libraries: where methods from stdio.h/stdlib.h come from Linker: Merges object files and libraries into one executable  gcc serves as a convenient linker frontend    C Compiler Stages The C compiler futher breaks down into:
 Pre-processor: For # directives, determines the actual C code seen by the compiler proper $ gcc -E ."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Week 7"><meta property="og:description" content="Week 7 Programming in C (cont.) Compiler and Linker Stages myProgram.c $\to$ Compiler $\to$ Machine Code (myProgram.o) $\to$ Libraries + Linker $\to$ Executable
 myProgram.o is the object code file Libraries: where methods from stdio.h/stdlib.h come from Linker: Merges object files and libraries into one executable  gcc serves as a convenient linker frontend    C Compiler Stages The C compiler futher breaks down into:
 Pre-processor: For # directives, determines the actual C code seen by the compiler proper $ gcc -E ."><meta property="og:type" content="article"><meta property="og:url" content="https://navn-r.github.io/notes/CSCB09/Week-7/"><meta property="article:published_time" content="2020-07-08T17:41:52+00:00"><meta property="article:modified_time" content="2020-07-08T17:41:52+00:00"><title>Week 7 - CSCB09</title><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@420&display=swap" rel=stylesheet><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.05ebbe252cb4c7ce23b9ebf0d8510e7f73238222a89b74e34ff88517b5a11fcb.css integrity="sha256-Beu+JSy0x84juevw2FEOf3MjgiKom3TjT/iFF7WhH8s="><script defer src=/notes/en.search.min.f3a2b9c36dbfd5ce1aa07d342d879f848cdefd233d2ee7759f403c4d37baebfd.js integrity="sha256-86K5w22/1c4aoH00LYefhIze/SM9Lud1n0A8TTe66/0="></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/notes><span>&lt;✏️ /></span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/notes/CSCA48/>CSCA48</a><ul><li><a href=/notes/CSCA48/final-review/>Final Review</a></li></ul></li><li><a href=/notes/CSCB09/ class=collapsed>CSCB09</a><ul><li><a href=/notes/CSCB09/Week-1/>Week 1</a></li><li><a href=/notes/CSCB09/Week-2/>Week 2</a></li><li><a href=/notes/CSCB09/Week-3/>Week 3</a></li><li><a href=/notes/CSCB09/Week-4/>Week 4</a></li><li><a href=/notes/CSCB09/Week-5/>Week 5</a></li><li><a href=/notes/CSCB09/Week-6/>Week 6</a></li><li><a href=/notes/CSCB09/Week-7/ class=active>Week 7</a></li></ul></li></ul><ul><li><a href=https://github.com/navn-r/course-notes target=_blank rel=noopener>Notes Repo (Github)</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Week 7</strong>
<label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#programming-in-c-cont>Programming in <code>C</code> (cont.)</a><ul><li><a href=#compiler-and-linker-stages>Compiler and Linker Stages</a></li><li><a href=#c-compiler-stages><code>C</code> Compiler Stages</a></li><li><a href=#pre-processor-directives>Pre-processor Directives</a></li><li><a href=#modularity-and-seperate-compilation>Modularity and Seperate Compilation</a></li><li><a href=#header-files>Header Files</a></li></ul></li><li><a href=#makefiles-and-make>Makefiles and <code>make</code></a><ul><li><a href=#most-basic-clauserule>Most Basic Clause/Rule</a></li><li><a href=#file-clean-up>File Clean Up</a></li><li><a href=#variables>Variables</a></li><li><a href=#automatic-variables-and-pattern-rules>Automatic Variables and Pattern Rules</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=week-7>Week 7</h1><h2 id=programming-in-c-cont>Programming in <code>C</code> (cont.)</h2><h3 id=compiler-and-linker-stages>Compiler and Linker Stages</h3><p><code>myProgram.c</code> $\to$ <strong>Compiler</strong> $\to$ <strong>Machine Code</strong> (<code>myProgram.o</code>) $\to$ Libraries + <strong>Linker</strong> $\to$ <strong>Executable</strong></p><ul><li><code>myProgram.o</code> is the <em>object code file</em></li><li>Libraries: where methods from <code>stdio.h/stdlib.h</code> come from</li><li>Linker: Merges object files and libraries into one executable<ul><li><code>gcc</code> serves as a convenient linker frontend</li></ul></li></ul><h3 id=c-compiler-stages><code>C</code> Compiler Stages</h3><p>The <code>C</code> compiler futher breaks down into:</p><ol><li>Pre-processor: For <code>#</code> directives, determines the actual <code>C</code> code seen by the compiler proper<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gcc -E ... <span style=color:#75715e># to see what the pre-processor actually does</span>
</code></pre></div></li><li>Compiler proper: Translates <code>C</code> code into machine code<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gcc -c ... <span style=color:#75715e># creates the object file with the machine code</span>
</code></pre></div></li></ol><h3 id=pre-processor-directives>Pre-processor Directives</h3><ul><li><code>#define</code> macros<ul><li>Textual substitution<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#define FINAL_COURSE_MARK 100 </span><span style=color:#75715e>// to define a macro
</span><span style=color:#75715e></span><span style=color:#75715e>#undef FINAL_COURSE_MARK      </span><span style=color:#75715e>// to remove the macro
</span></code></pre></div></li></ul></li><li><code>#include</code> for header files<ul><li>Header files usually contain<ul><li>Macro defintions</li><li>Types of exported functions and global variables</li></ul></li><li>Implementation<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;foo.h&gt; // looks for file in system-wide places (&#39;/usr/include&#39;)</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;foo.h&#34; // looks for file among user source code</span><span style=color:#75715e>
</span></code></pre></div></li></ul></li><li>Conditional Compilation<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#ifdef DEBUG_FLAG
</span><span style=color:#75715e></span>  fprintf(stderr, <span style=color:#e6db74>&#34;x=%d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x);
<span style=color:#75715e>#endif
</span></code></pre></div><ul><li>Common technique for debugging code</li><li>Also useful to check current OS (Windows/Linux)</li></ul></li></ul><h3 id=modularity-and-seperate-compilation>Modularity and Seperate Compilation</h3><ul><li>Keep closely-related code in the same files</li><li>Key idea/principle for good software design</li><li>Easier to modify and recompile one small file then one large file</li><li>Example:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>// Rectangle Struct with area function
</span><span style=color:#75715e></span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> rect_struct {
  <span style=color:#66d9ef>double</span> width, height;
} rect;
<span style=color:#66d9ef>double</span> <span style=color:#a6e22e>calcArea</span>(<span style=color:#66d9ef>const</span> rect <span style=color:#f92672>*</span>r) {
  <span style=color:#66d9ef>return</span> ... <span style=color:#75715e>//implementation goes here
</span><span style=color:#75715e></span>}

<span style=color:#75715e>// Linked-List Struct 
</span><span style=color:#75715e></span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> ll_node_struct {
  rect r;
  ll_node_struct <span style=color:#f92672>*</span>next;
} listNode;

<span style=color:#75715e>// Main Program
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
  rect r;
  listNode <span style=color:#f92672>*</span>newNode <span style=color:#f92672>=</span> (listNode <span style=color:#f92672>*</span>)calloc(<span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>sizeof</span>(listNode));
  printf(<span style=color:#e6db74>&#34;%d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, calcArea(<span style=color:#f92672>&amp;</span>r));
  ...
}
</code></pre></div><ul><li>This large file can be split into smaller more cohesive files<ul><li><code>rect.h</code>: includes type definition for <code>rect_struct</code> and <code>calcArea()</code> prototype</li><li><code>rect.c</code>: includes <code>calcArea()</code> implementation/definition</li><li><code>llnode.h</code>: includes <code>ll_node_struct</code> definition</li><li><code>main.c</code>: includes the main program<br><br></li></ul></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># only compile to machine code if it is necessary (new changes)</span>
$ gcc -c rect.c
$ ...
<span style=color:#75715e># takes the machine code and makes the executable</span>
$ gcc rect.o bb.o mainprog.o -o mainprog
</code></pre></div></li></ul><h3 id=header-files>Header Files</h3><ul><li>A seperate file <em>specifically</em> for macro/type definitions and function prototypes</li><li>Compiler wants to see the definition and prototype but you do not want to manually copy it to multiple files</li><li><strong><em>Note:</em></strong> It is illegal to see a type definition twice when compiling<ul><li>Solution: Using Conditional Compilation to check if the header file was already included from another file, and including if it hasn&rsquo;t<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#ifndef _FOO_H </span><span style=color:#75715e>// if _FOO_H has been defined already, skip
</span><span style=color:#75715e></span><span style=color:#75715e>#define _FOO_H </span><span style=color:#75715e>// if it has not been defined, then define it
</span><span style=color:#75715e></span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> node {
  <span style=color:#66d9ef>int</span> i;
  <span style=color:#66d9ef>struct</span> node <span style=color:#f92672>*</span>next;
} node;
<span style=color:#75715e>#endif
</span></code></pre></div></li></ul></li></ul><h2 id=makefiles-and-make>Makefiles and <code>make</code></h2><h3 id=most-basic-clauserule>Most Basic Clause/Rule</h3><ul><li><p>Form:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>TARGET : PREREQUISITES
  RECIPE
</code></pre></div></li><li><p>Example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>bb.o : bb.c bb.h rect.h <span style=color:#75715e># if `bb.o` is missing or older than `bb.c`, `bb.h` and `rect.h`</span>
  gcc -c bb.c           <span style=color:#75715e># then run this command (compile to machine code)</span>
</code></pre></div></li><li><p>If there are multiple rules in a Makefile:</p><ul><li><code>make</code> triggers the first rule (which may trigger other subsequent rules)</li><li>Order does not matter otherwise</li></ul></li><li><p>Customary to write first rule as</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>all : myexe1 myexe2 myexe3  <span style=color:#75715e># triggers other rules to build each myexe file</span>
.PHONY : all                <span style=color:#75715e># means `all` is just a label, not an actual target file</span>
</code></pre></div></li></ul><h3 id=file-clean-up>File Clean Up</h3><ul><li>Customary to add<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>clean :         <span style=color:#75715e># no prerequisites</span>
  rm -f *.o myexe1 myexe2 myexe3
.PHONY : clean 
</code></pre></div></li><li>Run <code>make clean</code> to invoke this target rule</li></ul><h3 id=variables>Variables</h3><ul><li>Defining variables from within a Makefile<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>CFLAGS <span style=color:#f92672>=</span> -g
</code></pre></div></li><li>Setting variables outside of a Makefile<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>make CFLAGS<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;-g -DMY_DEBUG_FLAG&#39;</span> <span style=color:#75715e># overrides CFLAGS from within Makefile</span>
</code></pre></div></li><li>Using a variable<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>gcc <span style=color:#66d9ef>$(</span>CFLAGS<span style=color:#66d9ef>)</span> -c bb.c
</code></pre></div></li></ul><h3 id=automatic-variables-and-pattern-rules>Automatic Variables and Pattern Rules</h3><ul><li><p>Non-example</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mainprog : mainprog.o bb.o rect.o
  gcc -g mainprog.o bb.o rect.o <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>      -o mainprog

mainprog.o : mainprog.c bb.h rect.h
  gcc -g -c mainprog.c

bb.o : bb.c bb.h rect.h
  gcc -g -c bb.c

rect.o : rect.c rect.h
  gcc -g -c rect.c
</code></pre></div></li><li><p>Using pattern rules</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mainprog : mainprog.o bb.o rect.o
  gcc -g $^ <span style=color:#75715e># all prereqs</span> 
      -o $@ <span style=color:#75715e># target</span>
    
%.o : %.c       <span style=color:#75715e># any `.o` target with `.c` prereq</span>
  gcc -g -c $&lt;  <span style=color:#75715e># build the first prereq</span>
</code></pre></div></li><li><p>Automatic prerequisite listing</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ gcc -MM mainprog.c bb.c rect.c
mainprog.o : mainprog.c rect.h bb.h
bb.o : bb.c rect.h bb.h
rect.o : rect.c rect.h
<span style=color:#75715e># copy the output to your Makefile</span>
</code></pre></div></li></ul><link rel=stylesheet href=/notes/katex/katex.min.css><script defer src=/notes/katex/katex.min.js></script><script defer src=/notes/katex/auto-render.min.js onload=renderMathInElement(document.body);></script><span>\(\)</span></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#programming-in-c-cont>Programming in <code>C</code> (cont.)</a><ul><li><a href=#compiler-and-linker-stages>Compiler and Linker Stages</a></li><li><a href=#c-compiler-stages><code>C</code> Compiler Stages</a></li><li><a href=#pre-processor-directives>Pre-processor Directives</a></li><li><a href=#modularity-and-seperate-compilation>Modularity and Seperate Compilation</a></li><li><a href=#header-files>Header Files</a></li></ul></li><li><a href=#makefiles-and-make>Makefiles and <code>make</code></a><ul><li><a href=#most-basic-clauserule>Most Basic Clause/Rule</a></li><li><a href=#file-clean-up>File Clean Up</a></li><li><a href=#variables>Variables</a></li><li><a href=#automatic-variables-and-pattern-rules>Automatic Variables and Pattern Rules</a></li></ul></li></ul></nav></aside></main><script defer src=/notes/katex/auto-render.min.js onload="renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},],});"></script></body></html>