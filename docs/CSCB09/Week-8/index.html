<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Week 8 #  File System with C #  i-nodes #    The file system has an array of &lsquo;i-nodes&rsquo;
  Every file and directory is identified using an i-node
  An i-node stores:
 Type: Regular file, dir, link, device, socket, etc. Permissions The owning user and owning group (numerical ids) Size Timestamps (created, last modified) Which disk blocks are used Other metadata    You can get most metadata by using the stat command">
<meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Week 8">
<meta property="og:description" content="Week 8 #  File System with C #  i-nodes #    The file system has an array of &lsquo;i-nodes&rsquo;
  Every file and directory is identified using an i-node
  An i-node stores:
 Type: Regular file, dir, link, device, socket, etc. Permissions The owning user and owning group (numerical ids) Size Timestamps (created, last modified) Which disk blocks are used Other metadata    You can get most metadata by using the stat command">
<meta property="og:type" content="article">
<meta property="og:url" content="https://navn-r.github.io/notes/CSCB09/Week-8/"><meta property="article:section" content="CSCB09">
<meta property="article:modified_time" content="2020-07-18T20:09:18+00:00">
<title>Week 8 - CSCB09</title>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@420&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel=stylesheet>
<link rel=manifest href=/notes/manifest.json>
<link rel=icon href=/notes/favicon.png type=image/x-icon>
<link rel=stylesheet href=/notes/book.min.a5fa8f1af9f5d59d69046c978df4e917aeaeb6896f8f0a7f2bc1e18969c454b8.css integrity="sha256-pfqPGvn11Z1pBGyXjfTpF66utolvjwp/K8HhiWnEVLg=">
<script defer src=/notes/en.search.min.bf26b46ace187e0eb8a88f2fe7aaa93e1c5e98118376a57d4d27d32532cd1de2.js integrity="sha256-vya0as4Yfg64qI8v56qpPhxemBGDdqV9TSfTJTLNHeI="></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a href=/notes/><span>&lt;✏️ /></span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<input type=checkbox id=section-41f305c5e3122bf493595a858d4129a1 class=toggle>
<label for=section-41f305c5e3122bf493595a858d4129a1 class="flex justify-between">
<a href=https://navn-r.github.io/notes/CSCA48/>CSCA48</a>
</label>
<ul>
<li>
<a href=https://navn-r.github.io/notes/CSCA48/final-review/>Final Review</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-78a08a9976aa3e789bbd624f3262ce34 class=toggle checked>
<label for=section-78a08a9976aa3e789bbd624f3262ce34 class="flex justify-between">
<a href=https://navn-r.github.io/notes/CSCB09/>CSCB09</a>
</label>
<ul>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-1/>Week 1</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-2/>Week 2</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-3/>Week 3</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-4/>Week 4</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-5/>Week 5</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-6/>Week 6</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-7/>Week 7</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-8/ class=active>Week 8</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-9/>Week 9</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-10/>Week 10</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCB09/Week-11/>Week 11</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-f93fc08454e785bc3348bdfad48cbd90 class=toggle>
<label for=section-f93fc08454e785bc3348bdfad48cbd90 class="flex justify-between">
<a href=https://navn-r.github.io/notes/CSCC01/>CSCC01</a>
</label>
<ul>
<li>
<a href=https://navn-r.github.io/notes/CSCC01/final-review/>Final Review</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-717d341229bce3459525c2c9d3ec32a6 class=toggle>
<label for=section-717d341229bce3459525c2c9d3ec32a6 class="flex justify-between">
<a href=https://navn-r.github.io/notes/CSCC24/>CSCC24</a>
</label>
<ul>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-1/>Week 1</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-2/>Week 2</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-3/>Week 3</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-4/>Week 4</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-5/>Week 5</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-6/>Week 6</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-7/>Week 7</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-8/>Week 8</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-9/>Week 9</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC24/Week-10/>Week 10</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-63a4e50557aed8f6e298fc725d63cc32 class=toggle>
<label for=section-63a4e50557aed8f6e298fc725d63cc32 class="flex justify-between">
<a href=https://navn-r.github.io/notes/CSCC43/>CSCC43</a>
</label>
<ul>
<li>
<a href=https://navn-r.github.io/notes/CSCC43/Week-1/>Week 1</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC43/Week-2/>Week 2</a>
</li>
<li>
<a href=https://navn-r.github.io/notes/CSCC43/Week-3/>Week 3</a>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<a href=https://github.com/navn-r/notes target=_blank rel=noopener>
Github Repo
</a>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/notes/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Week 8</strong>
<label for=toc-control>
<img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#file-system-with-c>File System with <code>C</code></a>
<ul>
<li><a href=#i-nodes>i-nodes</a></li>
<li><a href=#directories>Directories</a></li>
<li><a href=#linking>Linking</a></li>
<li><a href=#bitwise-operators-in-c>Bitwise Operators in <code>C</code></a></li>
<li><a href=#file-mode-bits>File Mode Bits</a></li>
<li><a href=#system-calls-for-file-io>System Calls for File I/O</a></li>
<li><a href=#file-descriptor-fd>File Descriptor (<code>fd</code>)</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=week-8>
Week 8
<a class=anchor href=#week-8>#</a>
</h1>
<h2 id=file-system-with-c>
File System with <code>C</code>
<a class=anchor href=#file-system-with-c>#</a>
</h2>
<h3 id=i-nodes>
i-nodes
<a class=anchor href=#i-nodes>#</a>
</h3>
<ul>
<li>
<p>The file system has an array of &lsquo;i-nodes&rsquo;</p>
</li>
<li>
<p>Every file and directory is identified using an i-node</p>
</li>
<li>
<p>An i-node stores:</p>
<ul>
<li>Type: Regular file, dir, link, device, socket, etc.</li>
<li>Permissions</li>
<li>The owning user and owning group (numerical ids)</li>
<li>Size</li>
<li>Timestamps (created, last modified)</li>
<li>Which disk blocks are used</li>
<li>Other metadata</li>
</ul>
</li>
<li>
<p>You can get most metadata by using the <code>stat</code> command</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Desktop ~$ stat
<span style=color:#ae81ff>2942805567</span> <span style=color:#ae81ff>687</span> crw--w---- <span style=color:#ae81ff>1</span> home tty <span style=color:#ae81ff>268435456</span> <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#34;Jul 18 13:29:59 2020&#34;</span> <span style=color:#e6db74>&#34;Jul 18 13:29:59 2020&#34;</span> <span style=color:#e6db74>&#34;Jul 18 13:29:59 2020&#34;</span> <span style=color:#e6db74>&#34;Dec 31 19:00:00 1969&#34;</span> <span style=color:#ae81ff>131072</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>stdin<span style=color:#f92672>)</span>
</code></pre></div></li>
</ul>
<h3 id=directories>
Directories
<a class=anchor href=#directories>#</a>
</h3>
<ul>
<li>Stores the mapping of filenames to i-node numbers</li>
<li>Data structure varies by system</li>
<li>The <code>C</code> functions <code>opendir, readdir, closedir</code> can access directories portably</li>
</ul>
<h3 id=linking>
Linking
<a class=anchor href=#linking>#</a>
</h3>
<h4 id=unlinking>
Unlinking
<a class=anchor href=#unlinking>#</a>
</h4>
<ul>
<li>Also known as deleting a file by its filename</li>
<li>When deleting a file, the kernel will:
<ol>
<li>Decrease the reference count of filenames referring to the i-node number</li>
<li>If the reference count is now 0, the disk space and the i-node is freed up</li>
</ol>
</li>
<li>System call for delete is <code>unlink</code></li>
</ul>
<h4 id=hard-link>
Hard link
<a class=anchor href=#hard-link>#</a>
</h4>
<ul>
<li>Creates a literal link between 2 files</li>
<li>Useful when you want to access a file in an inaccessible directory</li>
<li><code>ln</code> can create another filename that has the same i-node number as an existing file
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ ln path/to/file1 path/to/file2 <span style=color:#75715e># this creates a &#39;hard link&#39;</span>
</code></pre></div></li>
<li>The hard link between 2 files will not be broken if one of the file names change or even get deleted</li>
<li>Hard linking dirs is <strong><em>disallowed</em></strong> unless implementing special dirs like <code>.</code> and <code>..</code></li>
</ul>
<h4 id=symbolic-linking-symlink>
Symbolic Linking (Symlink)
<a class=anchor href=#symbolic-linking-symlink>#</a>
</h4>
<ul>
<li>Special file that simply stores a path (sort of like a shortcut)</li>
<li>Most system calls and <code>C</code> library functions/programs follows symlinks</li>
<li>Create a symlink using <code>ln -s</code></li>
</ul>
<h3 id=bitwise-operators-in-c>
Bitwise Operators in <code>C</code>
<a class=anchor href=#bitwise-operators-in-c>#</a>
</h3>
<ul>
<li>Bitwise AND (<code>&</code>), OR (<code>|</code>), NOT (<code>~</code>), XOR (<code>^</code>)</li>
<li>Left Shift (<code>&lt;&lt;</code>) and Right Shift (<code>>></code>)</li>
<li>Example:
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>10001001</span>; <span style=color:#75715e>// 8-bit binary
</span><span style=color:#75715e></span><span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> b <span style=color:#f92672>=</span> <span style=color:#ae81ff>00000011</span>;
a <span style=color:#f92672>&amp;</span> b   <span style=color:#f92672>=</span> <span style=color:#ae81ff>00000001</span>          <span style=color:#75715e>// logical AND on each bit
</span><span style=color:#75715e></span>a <span style=color:#f92672>|</span> b   <span style=color:#f92672>=</span> <span style=color:#ae81ff>10001011</span>          <span style=color:#75715e>// logical OR on each bit
</span><span style=color:#75715e></span>a <span style=color:#f92672>^</span> b   <span style=color:#f92672>=</span> <span style=color:#ae81ff>10001010</span>          <span style=color:#75715e>// XOR on each bit
</span><span style=color:#75715e></span><span style=color:#f92672>~</span> a     <span style=color:#f92672>=</span> <span style=color:#ae81ff>01110110</span>          <span style=color:#75715e>// flips all bits
</span><span style=color:#75715e></span>a <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>  <span style=color:#f92672>=</span> <span style=color:#ae81ff>00010010</span>          <span style=color:#75715e>// shifts all bits 1 to the left
</span><span style=color:#75715e></span>b <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>2</span>  <span style=color:#f92672>=</span> <span style=color:#ae81ff>00000000</span>          <span style=color:#75715e>// shifts all bits 2 to the right
</span></code></pre></div></li>
</ul>
<h3 id=file-mode-bits>
File Mode Bits
<a class=anchor href=#file-mode-bits>#</a>
</h3>
<ul>
<li>
<p><code>st_mode</code> bitwise layout</p>
<pre tabindex=0><code>    File Type                       Permissions
---------------- ------------------------------------------------
| - | - | - | - | U | G | T | R | W | X | R | W | X | R | W | X |
                            ----------- ----------- -----------
                                User       Group        Other
</code></pre></li>
<li>
<p>Macros for checking individual permissions:</p>
<ul>
<li><code>S_IRUSR</code>: Binary <code>0000 100 000 000</code></li>
<li><code>S_IWUSR</code>: Binary <code>0000 010 000 000</code></li>
<li><code>S_IXUSR</code>: Binary <code>0000 001 000 000</code></li>
</ul>
</li>
</ul>
<h3 id=system-calls-for-file-io>
System Calls for File I/O
<a class=anchor href=#system-calls-for-file-io>#</a>
</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>open</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>int</span> flags);
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>open</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>int</span> flags, <span style=color:#66d9ef>int</span> mode);
  flags: O_WRONLY, O_RDONLY, O_RDWR, O_EXCL, O_TRUNC, O_APPEND;
<span style=color:#75715e>// Combine flags with bitwise OR
</span><span style=color:#75715e></span>
size_t <span style=color:#a6e22e>read</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>buf, size_t count);
size_t <span style=color:#a6e22e>write</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>buf, size_t count);
off_t <span style=color:#a6e22e>lseek</span>(<span style=color:#66d9ef>int</span> fd, off_t offset, <span style=color:#66d9ef>int</span> origin);
  origin: SEEK_SET, SEEK_CUR, SEEK_END;

<span style=color:#75715e>// Takes another fdt entry to the same open file table entry
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>dup</span>(<span style=color:#66d9ef>int</span> oldfd);
<span style=color:#75715e>// takes fdt entry to be `newfd` and duplicates `oldfd` to it
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>dup2</span>(<span style=color:#66d9ef>int</span> oldfd, <span style=color:#66d9ef>int</span> newfd);

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>close</span>(<span style=color:#66d9ef>int</span> fd);
</code></pre></div><h3 id=file-descriptor-fd>
File Descriptor (<code>fd</code>)
<a class=anchor href=#file-descriptor-fd>#</a>
</h3>
<ul>
<li>Every process has a <em>finite</em> &lsquo;File descriptor table&rsquo; for opened files</li>
<li>The File Descriptor is an array index into it</li>
<li>Example of file descriptors:
<ul>
<li>0: <code>stdin</code></li>
<li>1: <code>stdout</code></li>
<li>2: <code>stderr</code></li>
</ul>
</li>
<li><code>open()</code> and <code>dup()</code> consumes the lowest-number free entry</li>
<li><code>close()</code> frees entries</li>
</ul>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#file-system-with-c>File System with <code>C</code></a>
<ul>
<li><a href=#i-nodes>i-nodes</a></li>
<li><a href=#directories>Directories</a></li>
<li><a href=#linking>Linking</a></li>
<li><a href=#bitwise-operators-in-c>Bitwise Operators in <code>C</code></a></li>
<li><a href=#file-mode-bits>File Mode Bits</a></li>
<li><a href=#system-calls-for-file-io>System Calls for File I/O</a></li>
<li><a href=#file-descriptor-fd>File Descriptor (<code>fd</code>)</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
<link rel=stylesheet href=/notes/katex/katex.min.css>
<script defer src=/notes/katex/katex.min.js></script>
<script defer src=/notes/katex/auto-render.min.js onload="renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1}]})"></script>
</body>
</html>