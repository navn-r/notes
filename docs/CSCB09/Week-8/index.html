<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Week 8
  #


  File System with C
  #


  i-nodes
  #



The file system has an array of &lsquo;i-nodes&rsquo;


Every file and directory is identified using an i-node


An i-node stores:

Type: Regular file, dir, link, device, socket, etc.
Permissions
The owning user and owning group (numerical ids)
Size
Timestamps (created, last modified)
Which disk blocks are used
Other metadata



You can get most metadata by using the stat command"><meta name=theme-color content="#FFFFFF"><meta property="og:url" content="https://navn.me/notes/CSCB09/Week-8/"><meta property="og:site_name" content="Notes"><meta property="og:title" content="Week 8"><meta property="og:description" content="Week 8 # File System with C # i-nodes # The file system has an array of ‘i-nodes’
Every file and directory is identified using an i-node
An i-node stores:
Type: Regular file, dir, link, device, socket, etc. Permissions The owning user and owning group (numerical ids) Size Timestamps (created, last modified) Which disk blocks are used Other metadata You can get most metadata by using the stat command"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="cscb09"><meta property="article:published_time" content="2020-07-18T20:09:18+00:00"><meta property="article:modified_time" content="2020-07-18T20:09:18+00:00"><title>Week 8 - cscb09</title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@420&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel=stylesheet><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.630665e30ad00e934c909605146e9dd098208e9d170377271366498a917ed656.css integrity="sha256-YwZl4wrQDpNMkJYFFG6d0Jggjp0XA3cnE2ZJipF+1lY=" crossorigin=anonymous><script defer src=/notes/fuse.min.js></script><script defer src=/notes/en.search.min.132f69159664ce019607f2e2194aff78c335d5bb6f36e556a80e2899a6da6dea.js integrity="sha256-Ey9pFZZkzgGWB/LiGUr/eMM11btvNuVWqA4omababeo=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/notes/><img src=/notes/logo.svg alt=Logo class=book-icon><span>Notes</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-eecd534dc11f03d48ad2e7d87541675c class=toggle>
<label for=section-eecd534dc11f03d48ad2e7d87541675c class=flex><a href=/notes/CSCA48/ class=flex-auto>CSCA48</a></label><ul><li><a href=/notes/CSCA48/final-review/>Final Review</a></li></ul></li><li><input type=checkbox id=section-0ded7730b14c7695e8d77042e371164e class=toggle checked>
<label for=section-0ded7730b14c7695e8d77042e371164e class=flex><a href=/notes/CSCB09/ class=flex-auto>CSCB09</a></label><ul><li><a href=/notes/CSCB09/Week-1/>Week 1</a></li><li><a href=/notes/CSCB09/Week-2/>Week 2</a></li><li><a href=/notes/CSCB09/Week-3/>Week 3</a></li><li><a href=/notes/CSCB09/Week-4/>Week 4</a></li><li><a href=/notes/CSCB09/Week-5/>Week 5</a></li><li><a href=/notes/CSCB09/Week-6/>Week 6</a></li><li><a href=/notes/CSCB09/Week-7/>Week 7</a></li><li><a href=/notes/CSCB09/Week-8/ class=active>Week 8</a></li><li><a href=/notes/CSCB09/Week-9/>Week 9</a></li><li><a href=/notes/CSCB09/Week-10/>Week 10</a></li><li><a href=/notes/CSCB09/Week-11/>Week 11</a></li></ul></li><li><input type=checkbox id=section-83878c136730e7fb5606682d9ae45dfe class=toggle>
<label for=section-83878c136730e7fb5606682d9ae45dfe class=flex><a href=/notes/CSCC01/ class=flex-auto>CSCC01</a></label><ul><li><a href=/notes/CSCC01/final-review/>Final Review</a></li><li><a href=/notes/CSCC01/ci-cd/>Guest Lecture - CI/CD</a></li></ul></li><li><input type=checkbox id=section-d311fefcc209fce910ef2e1c0a1fd052 class=toggle>
<label for=section-d311fefcc209fce910ef2e1c0a1fd052 class=flex><a href=/notes/CSCC24/ class=flex-auto>CSCC24</a></label><ul><li><a href=/notes/CSCC24/Week-1/>Week 1</a></li><li><a href=/notes/CSCC24/Week-2/>Week 2</a></li><li><a href=/notes/CSCC24/Week-3/>Week 3</a></li><li><a href=/notes/CSCC24/Week-4/>Week 4</a></li><li><a href=/notes/CSCC24/Week-5/>Week 5</a></li><li><a href=/notes/CSCC24/Week-6/>Week 6</a></li><li><a href=/notes/CSCC24/Week-7/>Week 7</a></li><li><a href=/notes/CSCC24/Week-8/>Week 8</a></li><li><a href=/notes/CSCC24/Week-9/>Week 9</a></li><li><a href=/notes/CSCC24/Week-10/>Week 10</a></li></ul></li><li><input type=checkbox id=section-a71f1103b1bf523367e6db76cc50f6a6 class=toggle>
<label for=section-a71f1103b1bf523367e6db76cc50f6a6 class=flex><a href=/notes/CSCC43/ class=flex-auto>CSCC43</a></label><ul><li><a href=/notes/CSCC43/final-review/>Final Review</a></li></ul></li><li><input type=checkbox id=section-45f38cf9287c788a19429c70038c2def class=toggle>
<label for=section-45f38cf9287c788a19429c70038c2def class=flex><a href=/notes/CSCC69/ class=flex-auto>CSCC69</a></label><ul><li><a href=/notes/CSCC69/final-review/>Final Review</a></li></ul></li></ul><ul><li><a href=https://github.com/navn-r/notes target=_blank rel=noopener>Github Repo</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label><h3>Week 8</h3><label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#file-system-with-c>File System with <code>C</code></a><ul><li><a href=#i-nodes>i-nodes</a></li><li><a href=#directories>Directories</a></li><li><a href=#linking>Linking</a></li><li><a href=#bitwise-operators-in-c>Bitwise Operators in <code>C</code></a></li><li><a href=#file-mode-bits>File Mode Bits</a></li><li><a href=#system-calls-for-file-io>System Calls for File I/O</a></li><li><a href=#file-descriptor-fd>File Descriptor (<code>fd</code>)</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=week-8>Week 8
<a class=anchor href=#week-8>#</a></h1><h2 id=file-system-with-c>File System with <code>C</code>
<a class=anchor href=#file-system-with-c>#</a></h2><h3 id=i-nodes>i-nodes
<a class=anchor href=#i-nodes>#</a></h3><ul><li><p>The file system has an array of &lsquo;i-nodes&rsquo;</p></li><li><p>Every file and directory is identified using an i-node</p></li><li><p>An i-node stores:</p><ul><li>Type: Regular file, dir, link, device, socket, etc.</li><li>Permissions</li><li>The owning user and owning group (numerical ids)</li><li>Size</li><li>Timestamps (created, last modified)</li><li>Which disk blocks are used</li><li>Other metadata</li></ul></li><li><p>You can get most metadata by using the <code>stat</code> command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Desktop ~$ stat
</span></span><span style=display:flex><span><span style=color:#ae81ff>2942805567</span> <span style=color:#ae81ff>687</span> crw--w---- <span style=color:#ae81ff>1</span> home tty <span style=color:#ae81ff>268435456</span> <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#34;Jul 18 13:29:59 2020&#34;</span> <span style=color:#e6db74>&#34;Jul 18 13:29:59 2020&#34;</span> <span style=color:#e6db74>&#34;Jul 18 13:29:59 2020&#34;</span> <span style=color:#e6db74>&#34;Dec 31 19:00:00 1969&#34;</span> <span style=color:#ae81ff>131072</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>stdin<span style=color:#f92672>)</span>
</span></span></code></pre></div></li></ul><h3 id=directories>Directories
<a class=anchor href=#directories>#</a></h3><ul><li>Stores the mapping of filenames to i-node numbers</li><li>Data structure varies by system</li><li>The <code>C</code> functions <code>opendir, readdir, closedir</code> can access directories portably</li></ul><h3 id=linking>Linking
<a class=anchor href=#linking>#</a></h3><h4 id=unlinking>Unlinking
<a class=anchor href=#unlinking>#</a></h4><ul><li>Also known as deleting a file by its filename</li><li>When deleting a file, the kernel will:<ol><li>Decrease the reference count of filenames referring to the i-node number</li><li>If the reference count is now 0, the disk space and the i-node is freed up</li></ol></li><li>System call for delete is <code>unlink</code></li></ul><h4 id=hard-link>Hard link
<a class=anchor href=#hard-link>#</a></h4><ul><li>Creates a literal link between 2 files</li><li>Useful when you want to access a file in an inaccessible directory</li><li><code>ln</code> can create another filename that has the same i-node number as an existing file<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ln path/to/file1 path/to/file2 <span style=color:#75715e># this creates a &#39;hard link&#39;</span>
</span></span></code></pre></div></li><li>The hard link between 2 files will not be broken if one of the file names change or even get deleted</li><li>Hard linking dirs is <strong><em>disallowed</em></strong> unless implementing special dirs like <code>.</code> and <code>..</code></li></ul><h4 id=symbolic-linking-symlink>Symbolic Linking (Symlink)
<a class=anchor href=#symbolic-linking-symlink>#</a></h4><ul><li>Special file that simply stores a path (sort of like a shortcut)</li><li>Most system calls and <code>C</code> library functions/programs follows symlinks</li><li>Create a symlink using <code>ln -s</code></li></ul><h3 id=bitwise-operators-in-c>Bitwise Operators in <code>C</code>
<a class=anchor href=#bitwise-operators-in-c>#</a></h3><ul><li>Bitwise AND (<code>&</code>), OR (<code>|</code>), NOT (<code>~</code>), XOR (<code>^</code>)</li><li>Left Shift (<code>&lt;&lt;</code>) and Right Shift (<code>>></code>)</li><li>Example:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>10001001</span>; <span style=color:#75715e>// 8-bit binary
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>char</span> b <span style=color:#f92672>=</span> <span style=color:#ae81ff>00000011</span>;
</span></span><span style=display:flex><span>a <span style=color:#f92672>&amp;</span> b   <span style=color:#f92672>=</span> <span style=color:#ae81ff>00000001</span>          <span style=color:#75715e>// logical AND on each bit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>a <span style=color:#f92672>|</span> b   <span style=color:#f92672>=</span> <span style=color:#ae81ff>10001011</span>          <span style=color:#75715e>// logical OR on each bit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>a <span style=color:#f92672>^</span> b   <span style=color:#f92672>=</span> <span style=color:#ae81ff>10001010</span>          <span style=color:#75715e>// XOR on each bit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>~</span> a     <span style=color:#f92672>=</span> <span style=color:#ae81ff>01110110</span>          <span style=color:#75715e>// flips all bits
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>a <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>  <span style=color:#f92672>=</span> <span style=color:#ae81ff>00010010</span>          <span style=color:#75715e>// shifts all bits 1 to the left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>b <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>2</span>  <span style=color:#f92672>=</span> <span style=color:#ae81ff>00000000</span>          <span style=color:#75715e>// shifts all bits 2 to the right
</span></span></span></code></pre></div></li></ul><h3 id=file-mode-bits>File Mode Bits
<a class=anchor href=#file-mode-bits>#</a></h3><ul><li><p><code>st_mode</code> bitwise layout</p><pre tabindex=0><code>    File Type                       Permissions
---------------- ------------------------------------------------
| - | - | - | - | U | G | T | R | W | X | R | W | X | R | W | X |
                            ----------- ----------- -----------
                                User       Group        Other
</code></pre></li><li><p>Macros for checking individual permissions:</p><ul><li><code>S_IRUSR</code>: Binary <code>0000 100 000 000</code></li><li><code>S_IWUSR</code>: Binary <code>0000 010 000 000</code></li><li><code>S_IXUSR</code>: Binary <code>0000 001 000 000</code></li></ul></li></ul><h3 id=system-calls-for-file-io>System Calls for File I/O
<a class=anchor href=#system-calls-for-file-io>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>open</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>int</span> flags);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>open</span>(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path, <span style=color:#66d9ef>int</span> flags, <span style=color:#66d9ef>int</span> mode);
</span></span><span style=display:flex><span>  flags: O_WRONLY, O_RDONLY, O_RDWR, O_EXCL, O_TRUNC, O_APPEND;
</span></span><span style=display:flex><span><span style=color:#75715e>// Combine flags with bitwise OR
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>size_t</span> <span style=color:#a6e22e>read</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>buf, <span style=color:#66d9ef>size_t</span> count);
</span></span><span style=display:flex><span><span style=color:#66d9ef>size_t</span> <span style=color:#a6e22e>write</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>buf, <span style=color:#66d9ef>size_t</span> count);
</span></span><span style=display:flex><span><span style=color:#66d9ef>off_t</span> <span style=color:#a6e22e>lseek</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>off_t</span> offset, <span style=color:#66d9ef>int</span> origin);
</span></span><span style=display:flex><span>  origin: SEEK_SET, SEEK_CUR, SEEK_END;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Takes another fdt entry to the same open file table entry
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>dup</span>(<span style=color:#66d9ef>int</span> oldfd);
</span></span><span style=display:flex><span><span style=color:#75715e>// takes fdt entry to be `newfd` and duplicates `oldfd` to it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>dup2</span>(<span style=color:#66d9ef>int</span> oldfd, <span style=color:#66d9ef>int</span> newfd);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>close</span>(<span style=color:#66d9ef>int</span> fd);
</span></span></code></pre></div><h3 id=file-descriptor-fd>File Descriptor (<code>fd</code>)
<a class=anchor href=#file-descriptor-fd>#</a></h3><ul><li>Every process has a <em>finite</em> &lsquo;File descriptor table&rsquo; for opened files</li><li>The File Descriptor is an array index into it</li><li>Example of file descriptors:<ul><li>0: <code>stdin</code></li><li>1: <code>stdout</code></li><li>2: <code>stderr</code></li></ul></li><li><code>open()</code> and <code>dup()</code> consumes the lowest-number free entry</li><li><code>close()</code> frees entries</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#file-system-with-c>File System with <code>C</code></a><ul><li><a href=#i-nodes>i-nodes</a></li><li><a href=#directories>Directories</a></li><li><a href=#linking>Linking</a></li><li><a href=#bitwise-operators-in-c>Bitwise Operators in <code>C</code></a></li><li><a href=#file-mode-bits>File Mode Bits</a></li><li><a href=#system-calls-for-file-io>System Calls for File I/O</a></li><li><a href=#file-descriptor-fd>File Descriptor (<code>fd</code>)</a></li></ul></li></ul></nav></div></aside></main><link rel=stylesheet href=/notes/katex/katex.min.css><script defer src=/notes/katex/katex.min.js></script><script defer src=/notes/katex/auto-render.min.js onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})'></script></body></html>