<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Week 10
  #


  Sockets
  #


Another way for two processes to communicate

  Characteristics of Sockets
  #


Has 2 sides: Server and Client

Server: has a publishable address
Client: contacts Server by published address


Unrelated processes, even on different computers, can contact each other through sockets


  Socket Varieties
  #


  By Domain
  #


Unix Domain: Local to the computer, address is a filename
IPv4: Over the network, 32-bit address + 16-bit port number
IPv6: 128-bit address and over the network


  By Abstraction Level
  #


Datagram:

Per packet
Packet boundary preserved, packet order is not
Unnoticed packet loss


Stream:

Network stack works hard to confirm, timeout, resend
Preserves data order
No packet boundary




  Stream Socket Workflow
  #


  Client
  #


Call socket, creates the socket fd
Fill in the address struct and use connect to connect to the server at the address
Use the socket fd to communicate with the server
Close the fd when done


  Server
  #


Call socket to create the server socket fd
Fill in the address struct and use bind to bind the sfd to the address
Call listen
Loop

Call accept(sfd) to wait for client to connect, gets back a client fd
Use the cfd to communicate with client, close when done


Close the server socket fd if no longer waiting for clients


  Creating Sockets
  #

int socket(int family, int type, int protocol); // returns socket fd > 0, -1 if error

family: AF_UNIX, AF_INET (IPv4), AF_INET6 (IPv6)
type: SOCK_DGRAM, SOCK_STREAM
protocol: 0


  IPv4 Addresses and Port struct
  #


Adresses are 32-bit, and identifies network interfaces (computers)
Each byte is seperated by dots. (ex 142.1.96.164)
dig can look up IP Addresses from domain names by asking Domain Name Servers (DNS)
Port struct:
struct sockaddr_in {
  sa_family_t     sin_family;  // AF_INET
  in_port_t       sin_port;    // port, need to be in network byte order
  struct in_addr  sin_addr;    // IPv4 address, also in NBO
};

struct in_addr {
  uint32_t        s_addr;
}

Special addresses

127.0.0.1: Loopback (You can see this example when using localhost or any web server running on your computer)
0.0.0.0: Request binding to all network interfaces




  Endians and Network Byte Order
  #


Big Endian (Network Byte Order): Left to right (ex. 772 in decimal = 03 04)
Little Endian: Bytes are swapped (ex. 772 in decimal = 04 03)
Use the library functions htonl (32-bit) and htons (16-bit) to convert from Little to Big Endian


  bind, accept and connect
  #

int bind(int fd, const struct sockaddr *addr, socklen_t addrlen);

sockaddr: sockaddr_in (IPv4), sockaddr_in6 (IPv6), sockaddr_un (UNIX)

int accept(int fd, struct sockaddr *client_addr, socklen_t addrlen);

Returns new socket cfd for talking to client
client_addr will recieve the address of client

int connect(int fd, const struct sockaddr *server_addr, socklen_t addrlen);

Returns 0 if success, -1 on error
fd can now talk to the server


  Broken Pipes
  #


If one end of the pipe is closed before the other one, the processes gets SIGPIPE
The default action is the processes gets killed
Eg.
$ uniq longFile.txt | head -1 
# 'head' end of pipe closes after the first line
# but 'uniq' is still running, hence the process just ends

To override the default, set action to SIG_IGN (ignore)
"><meta name=theme-color content="#FFFFFF"><meta property="og:url" content="https://navn.me/notes/CSCB09/Week-10/"><meta property="og:site_name" content="Notes"><meta property="og:title" content="Week 10"><meta property="og:description" content="Week 10 # Sockets # Another way for two processes to communicate
Characteristics of Sockets # Has 2 sides: Server and Client Server: has a publishable address Client: contacts Server by published address Unrelated processes, even on different computers, can contact each other through sockets Socket Varieties # By Domain # Unix Domain: Local to the computer, address is a filename IPv4: Over the network, 32-bit address + 16-bit port number IPv6: 128-bit address and over the network By Abstraction Level # Datagram: Per packet Packet boundary preserved, packet order is not Unnoticed packet loss Stream: Network stack works hard to confirm, timeout, resend Preserves data order No packet boundary Stream Socket Workflow # Client # Call socket, creates the socket fd Fill in the address struct and use connect to connect to the server at the address Use the socket fd to communicate with the server Close the fd when done Server # Call socket to create the server socket fd Fill in the address struct and use bind to bind the sfd to the address Call listen Loop Call accept(sfd) to wait for client to connect, gets back a client fd Use the cfd to communicate with client, close when done Close the server socket fd if no longer waiting for clients Creating Sockets # int socket(int family, int type, int protocol); // returns socket fd > 0, -1 if error family: AF_UNIX, AF_INET (IPv4), AF_INET6 (IPv6) type: SOCK_DGRAM, SOCK_STREAM protocol: 0 IPv4 Addresses and Port struct # Adresses are 32-bit, and identifies network interfaces (computers) Each byte is seperated by dots. (ex 142.1.96.164) dig can look up IP Addresses from domain names by asking Domain Name Servers (DNS) Port struct: struct sockaddr_in { sa_family_t sin_family; // AF_INET in_port_t sin_port; // port, need to be in network byte order struct in_addr sin_addr; // IPv4 address, also in NBO }; struct in_addr { uint32_t s_addr; } Special addresses 127.0.0.1: Loopback (You can see this example when using localhost or any web server running on your computer) 0.0.0.0: Request binding to all network interfaces Endians and Network Byte Order # Big Endian (Network Byte Order): Left to right (ex. 772 in decimal = 03 04) Little Endian: Bytes are swapped (ex. 772 in decimal = 04 03) Use the library functions htonl (32-bit) and htons (16-bit) to convert from Little to Big Endian bind, accept and connect # int bind(int fd, const struct sockaddr *addr, socklen_t addrlen); sockaddr: sockaddr_in (IPv4), sockaddr_in6 (IPv6), sockaddr_un (UNIX) int accept(int fd, struct sockaddr *client_addr, socklen_t addrlen); Returns new socket cfd for talking to client client_addr will recieve the address of client int connect(int fd, const struct sockaddr *server_addr, socklen_t addrlen); Returns 0 if success, -1 on error fd can now talk to the server Broken Pipes # If one end of the pipe is closed before the other one, the processes gets SIGPIPE The default action is the processes gets killed Eg. $ uniq longFile.txt | head -1 # 'head' end of pipe closes after the first line # but 'uniq' is still running, hence the process just ends To override the default, set action to SIG_IGN (ignore)"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="cscb09"><meta property="article:published_time" content="2020-08-03T18:51:53+00:00"><meta property="article:modified_time" content="2020-08-03T18:51:53+00:00"><title>Week 10 - cscb09</title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@420&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap" rel=stylesheet><link rel=manifest href=/notes/manifest.json><link rel=icon href=/notes/favicon.png type=image/x-icon><link rel=stylesheet href=/notes/book.min.630665e30ad00e934c909605146e9dd098208e9d170377271366498a917ed656.css integrity="sha256-YwZl4wrQDpNMkJYFFG6d0Jggjp0XA3cnE2ZJipF+1lY=" crossorigin=anonymous><script defer src=/notes/fuse.min.js></script><script defer src=/notes/en.search.min.ed042990b18b4bf58846c3aeee97d868986dfe7c91b54bb2a6877f3ae58a821b.js integrity="sha256-7QQpkLGLS/WIRsOu7pfYaJht/nyRtUuypod/OuWKghs=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/notes/><img src=/notes/logo.png alt=Logo class=book-icon><span>Notes</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-eecd534dc11f03d48ad2e7d87541675c class=toggle>
<label for=section-eecd534dc11f03d48ad2e7d87541675c class=flex><a href=/notes/CSCA48/ class=flex-auto>CSCA48</a></label><ul><li><a href=/notes/CSCA48/final-review/>Final Review</a></li></ul></li><li><input type=checkbox id=section-0ded7730b14c7695e8d77042e371164e class=toggle checked>
<label for=section-0ded7730b14c7695e8d77042e371164e class=flex><a href=/notes/CSCB09/ class=flex-auto>CSCB09</a></label><ul><li><a href=/notes/CSCB09/Week-1/>Week 1</a></li><li><a href=/notes/CSCB09/Week-2/>Week 2</a></li><li><a href=/notes/CSCB09/Week-3/>Week 3</a></li><li><a href=/notes/CSCB09/Week-4/>Week 4</a></li><li><a href=/notes/CSCB09/Week-5/>Week 5</a></li><li><a href=/notes/CSCB09/Week-6/>Week 6</a></li><li><a href=/notes/CSCB09/Week-7/>Week 7</a></li><li><a href=/notes/CSCB09/Week-8/>Week 8</a></li><li><a href=/notes/CSCB09/Week-9/>Week 9</a></li><li><a href=/notes/CSCB09/Week-10/ class=active>Week 10</a></li><li><a href=/notes/CSCB09/Week-11/>Week 11</a></li></ul></li><li><input type=checkbox id=section-83878c136730e7fb5606682d9ae45dfe class=toggle>
<label for=section-83878c136730e7fb5606682d9ae45dfe class=flex><a href=/notes/CSCC01/ class=flex-auto>CSCC01</a></label><ul><li><a href=/notes/CSCC01/final-review/>Final Review</a></li></ul></li><li><input type=checkbox id=section-d311fefcc209fce910ef2e1c0a1fd052 class=toggle>
<label for=section-d311fefcc209fce910ef2e1c0a1fd052 class=flex><a href=/notes/CSCC24/ class=flex-auto>CSCC24</a></label><ul><li><a href=/notes/CSCC24/Week-1/>Week 1</a></li><li><a href=/notes/CSCC24/Week-2/>Week 2</a></li><li><a href=/notes/CSCC24/Week-3/>Week 3</a></li><li><a href=/notes/CSCC24/Week-4/>Week 4</a></li><li><a href=/notes/CSCC24/Week-5/>Week 5</a></li><li><a href=/notes/CSCC24/Week-6/>Week 6</a></li><li><a href=/notes/CSCC24/Week-7/>Week 7</a></li><li><a href=/notes/CSCC24/Week-8/>Week 8</a></li><li><a href=/notes/CSCC24/Week-9/>Week 9</a></li><li><a href=/notes/CSCC24/Week-10/>Week 10</a></li></ul></li><li><input type=checkbox id=section-a71f1103b1bf523367e6db76cc50f6a6 class=toggle>
<label for=section-a71f1103b1bf523367e6db76cc50f6a6 class=flex><a href=/notes/CSCC43/ class=flex-auto>CSCC43</a></label><ul><li><a href=/notes/CSCC43/final-review/>Final Review</a></li></ul></li><li><input type=checkbox id=section-45f38cf9287c788a19429c70038c2def class=toggle>
<label for=section-45f38cf9287c788a19429c70038c2def class=flex><a href=/notes/CSCC69/ class=flex-auto>CSCC69</a></label><ul><li><a href=/notes/CSCC69/final-review/>Final Review</a></li></ul></li></ul><ul><li><a href=https://github.com/navn-r/notes target=_blank rel=noopener>Github Repo</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/notes/svg/menu.svg class=book-icon alt=Menu></label><h3>Week 10</h3><label for=toc-control><img src=/notes/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#sockets>Sockets</a><ul><li><a href=#characteristics-of-sockets>Characteristics of Sockets</a></li><li><a href=#socket-varieties>Socket Varieties</a></li><li><a href=#stream-socket-workflow>Stream Socket Workflow</a></li><li><a href=#creating-sockets>Creating Sockets</a></li><li><a href=#ipv4-addresses-and-port-struct>IPv4 Addresses and Port struct</a></li><li><a href=#endians-and-network-byte-order>Endians and Network Byte Order</a></li><li><a href=#bind-accept-and-connect><code>bind</code>, <code>accept</code> and <code>connect</code></a></li><li><a href=#broken-pipes>Broken Pipes</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=week-10>Week 10
<a class=anchor href=#week-10>#</a></h1><h2 id=sockets>Sockets
<a class=anchor href=#sockets>#</a></h2><blockquote><p>Another way for two processes to communicate</p></blockquote><h3 id=characteristics-of-sockets>Characteristics of Sockets
<a class=anchor href=#characteristics-of-sockets>#</a></h3><ul><li>Has 2 sides: Server and Client<ul><li>Server: has a publishable address</li><li>Client: contacts Server by published address</li></ul></li><li>Unrelated processes, even on different computers, can contact each other through sockets</li></ul><h3 id=socket-varieties>Socket Varieties
<a class=anchor href=#socket-varieties>#</a></h3><h4 id=by-domain>By Domain
<a class=anchor href=#by-domain>#</a></h4><ul><li>Unix Domain: Local to the computer, address is a filename</li><li>IPv4: Over the network, 32-bit address + 16-bit port number</li><li>IPv6: 128-bit address and over the network</li></ul><h4 id=by-abstraction-level>By Abstraction Level
<a class=anchor href=#by-abstraction-level>#</a></h4><ul><li>Datagram:<ul><li>Per packet</li><li>Packet boundary preserved, packet order is not</li><li>Unnoticed packet loss</li></ul></li><li>Stream:<ul><li>Network stack works hard to confirm, timeout, resend</li><li>Preserves data order</li><li>No packet boundary</li></ul></li></ul><h3 id=stream-socket-workflow>Stream Socket Workflow
<a class=anchor href=#stream-socket-workflow>#</a></h3><h4 id=client>Client
<a class=anchor href=#client>#</a></h4><ol><li>Call <code>socket</code>, creates the socket fd</li><li>Fill in the address struct and use <code>connect</code> to connect to the server at the address</li><li>Use the socket fd to communicate with the server</li><li>Close the fd when done</li></ol><h4 id=server>Server
<a class=anchor href=#server>#</a></h4><ol><li>Call <code>socket</code> to create the server socket fd</li><li>Fill in the address struct and use <code>bind</code> to bind the sfd to the address</li><li>Call <code>listen</code></li><li>Loop<ol><li>Call <code>accept(sfd)</code> to wait for client to connect, gets back a client fd</li><li>Use the cfd to communicate with client, close when done</li></ol></li><li>Close the server socket fd if no longer waiting for clients</li></ol><h3 id=creating-sockets>Creating Sockets
<a class=anchor href=#creating-sockets>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>socket</span>(<span style=color:#66d9ef>int</span> family, <span style=color:#66d9ef>int</span> type, <span style=color:#66d9ef>int</span> protocol); <span style=color:#75715e>// returns socket fd &gt; 0, -1 if error
</span></span></span></code></pre></div><ul><li><code>family</code>: <code>AF_UNIX</code>, <code>AF_INET</code> (IPv4), <code>AF_INET6</code> (IPv6)</li><li><code>type</code>: <code>SOCK_DGRAM</code>, <code>SOCK_STREAM</code></li><li><code>protocol</code>: <code>0</code></li></ul><h3 id=ipv4-addresses-and-port-struct>IPv4 Addresses and Port struct
<a class=anchor href=#ipv4-addresses-and-port-struct>#</a></h3><ul><li>Adresses are 32-bit, and identifies network interfaces (computers)</li><li>Each byte is seperated by dots. (ex <code>142.1.96.164</code>)</li><li><code>dig</code> can look up IP Addresses from domain names by asking Domain Name Servers (DNS)</li><li>Port struct:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>struct</span> sockaddr_in {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>sa_family_t</span>     sin_family;  <span style=color:#75715e>// AF_INET
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>in_port_t</span>       sin_port;    <span style=color:#75715e>// port, need to be in network byte order
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>struct</span> in_addr  sin_addr;    <span style=color:#75715e>// IPv4 address, also in NBO
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> in_addr {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>uint32_t</span>        s_addr;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Special addresses<ul><li><code>127.0.0.1</code>: Loopback (You can see this example when using <code>localhost</code> or any web server running on your computer)</li><li><code>0.0.0.0</code>: Request binding to all network interfaces</li></ul></li></ul><h3 id=endians-and-network-byte-order>Endians and Network Byte Order
<a class=anchor href=#endians-and-network-byte-order>#</a></h3><ul><li>Big Endian (Network Byte Order): Left to right (ex. 772 in decimal = 03 04)</li><li>Little Endian: Bytes are swapped (ex. 772 in decimal = 04 03)</li><li>Use the library functions <code>htonl</code> (32-bit) and <code>htons</code> (16-bit) to convert from Little to Big Endian</li></ul><h3 id=bind-accept-and-connect><code>bind</code>, <code>accept</code> and <code>connect</code>
<a class=anchor href=#bind-accept-and-connect>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>struct</span> sockaddr <span style=color:#f92672>*</span>addr, <span style=color:#66d9ef>socklen_t</span> addrlen);
</span></span></code></pre></div><ul><li><code>sockaddr</code>: <code>sockaddr_in</code> (IPv4), <code>sockaddr_in6</code> (IPv6), <code>sockaddr_un</code> (UNIX)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>accept</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>struct</span> sockaddr <span style=color:#f92672>*</span>client_addr, <span style=color:#66d9ef>socklen_t</span> addrlen);
</span></span></code></pre></div><ul><li>Returns new socket cfd for talking to client</li><li><code>client_addr</code> will recieve the address of client</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>connect</span>(<span style=color:#66d9ef>int</span> fd, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>struct</span> sockaddr <span style=color:#f92672>*</span>server_addr, <span style=color:#66d9ef>socklen_t</span> addrlen);
</span></span></code></pre></div><ul><li>Returns 0 if success, -1 on error</li><li><code>fd</code> can now talk to the server</li></ul><h3 id=broken-pipes>Broken Pipes
<a class=anchor href=#broken-pipes>#</a></h3><ul><li>If one end of the pipe is closed before the other one, the processes gets <code>SIGPIPE</code></li><li>The default action is the processes gets killed</li><li>Eg.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ uniq longFile.txt | head -1 
</span></span><span style=display:flex><span><span style=color:#75715e># &#39;head&#39; end of pipe closes after the first line</span>
</span></span><span style=display:flex><span><span style=color:#75715e># but &#39;uniq&#39; is still running, hence the process just ends</span>
</span></span></code></pre></div></li><li>To override the default, set action to <code>SIG_IGN</code> (ignore)</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#sockets>Sockets</a><ul><li><a href=#characteristics-of-sockets>Characteristics of Sockets</a></li><li><a href=#socket-varieties>Socket Varieties</a></li><li><a href=#stream-socket-workflow>Stream Socket Workflow</a></li><li><a href=#creating-sockets>Creating Sockets</a></li><li><a href=#ipv4-addresses-and-port-struct>IPv4 Addresses and Port struct</a></li><li><a href=#endians-and-network-byte-order>Endians and Network Byte Order</a></li><li><a href=#bind-accept-and-connect><code>bind</code>, <code>accept</code> and <code>connect</code></a></li><li><a href=#broken-pipes>Broken Pipes</a></li></ul></li></ul></nav></div></aside></main><link rel=stylesheet href=/notes/katex/katex.min.css><script defer src=/notes/katex/katex.min.js></script><script defer src=/notes/katex/auto-render.min.js onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})'></script></body></html>